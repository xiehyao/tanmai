# ğŸš¨ æ¢è„‰ tanmai å¼ºåˆ¶è§„åˆ™ - å¿…è¯» ğŸš¨

## 0. å¼€å‘ç¯å¢ƒèƒŒæ™¯

- **è¿œç¨‹å¼€å‘**ï¼šæœ¬åœ° Mac é€šè¿‡ SSH ç™»å½•æœåŠ¡å™¨ï¼ˆåŸŸå www.pengyoo.comï¼ŒIP 43.143.224.158ï¼‰ï¼Œç”¨ Cursor åšè¿œç¨‹ AI ç¼–ç¨‹
- **æœåŠ¡å™¨**ï¼šApacheã€æ•°æ®åº“å‡åœ¨æœåŠ¡å™¨ä¸Šï¼›Cursor ç»ˆç«¯å¯ç›´æ¥æ“ä½œæœåŠ¡å™¨ï¼Œå¿…è¦æ—¶å¯æ¥ç®¡æœåŠ¡å™¨ç»ˆç«¯
- **å°ç¨‹åºè°ƒè¯•**ï¼šMac ç”¨ sshfs + macfuse æŒ‚è½½æœåŠ¡å™¨ `/var/www/html/moodle/tanmai/`ï¼Œå¾®ä¿¡å®˜æ–¹å¼€å‘è€…å·¥å…·æ‰“å¼€æŒ‚è½½åçš„ `wx-mini` æ–‡ä»¶å¤¹è¿›è¡Œä½“éªŒä¸æˆªå›¾

## 1. Git æäº¤ + ä¸‰å¤‡ä»½æ¨é€ï¼ˆå¼ºåˆ¶ï¼‰

å¯¹ `tanmai/backend/`ã€`tanmai/wx-mini/`ã€`tanmai/frontend/` åš**éä¸´æ—¶æ€§æ”¹åŠ¨**æ—¶ï¼Œå¿…é¡»ï¼š

1. `git status` / `git diff` è‡ªæ£€
2. **æ£€æŸ¥ `tanmai/` ä¸‹æ‰€æœ‰ç›¸å…³æ–‡ä»¶æ˜¯å¦å·²åŠ å…¥ git**ï¼›è‹¥æœ‰æœªè·Ÿè¸ªæˆ–æœªæš‚å­˜çš„æ”¹åŠ¨ï¼Œç«‹å³ `git add` å¹¶æäº¤
3. `git add` **æ‰€æœ‰ç›¸å…³æ–‡ä»¶**ï¼ˆå¦‚æ”¹ alumni-link éœ€åŒæ—¶ add .js / .wxml / .wxssï¼‰
4. `git commit -m "æ¨¡å—ï¼šç®€çŸ­æè¿°"`ï¼Œç¤ºä¾‹ï¼š
   - `åç«¯ï¼šxxx æ¥å£` / `å°ç¨‹åºï¼šxxx é¡µé¢`
   - `feat: æ–°åŠŸèƒ½` / `fix: ä¿®å¤ xxx`
5. **ç«‹å³æ‰§è¡Œä¸‰å¤‡ä»½æ¨é€**ï¼š`./scripts/git-sync.sh push`ï¼ˆåŒæ—¶æ¨é€åˆ° æœ¬åœ° Gitea + æ–°åŠ å¡ Gitea + GitHubï¼‰

**ç¦æ­¢**é‡è¦ä»£ç é•¿æœŸåªåœ¨å·¥ä½œåŒºã€ä¸æäº¤ã€‚**ç¦æ­¢**æäº¤åä¸æ¨é€ã€‚

## 2. ä¼šè¯ç»“æŸå‰è‡ªæ£€

åœ¨å®Œæˆç”¨æˆ·ä»»åŠ¡ã€å‡†å¤‡ç»“æŸå›å¤å‰ï¼Œå¿…é¡»ï¼š

- æ‰§è¡Œ `git status`ï¼Œè‹¥æœ‰æœªæäº¤æ”¹åŠ¨ï¼Œç«‹å³å®Œæˆ `git add` + `git commit`
- **æ¯æ¬¡ commit åå¿…é¡»æ‰§è¡Œ** `./scripts/git-sync.sh push`ï¼Œç¡®ä¿ä¸‰å¤‡ä»½ï¼ˆæœ¬åœ° Gitea + æ–°åŠ å¡ Gitea + GitHubï¼‰åŒæ­¥
- **æ£€æŸ¥åç«¯æœåŠ¡**ï¼šè‹¥æœ¬æ¬¡ä¿®æ”¹æ¶‰åŠ `tanmai/backend/`ï¼Œå…ˆè¿è¡Œ `cd tanmai/backend && pytest tests/ -v`ï¼Œé€šè¿‡åå†é‡å¯ uvicorn
- è‹¥ä¸ºä¸´æ—¶ä»£ç ï¼Œéœ€åœ¨å¯¹è¯ä¸­æ˜ç¡®è¯´æ˜

## 3. å—ä¿æŠ¤æ–‡ä»¶

- **`.cursorrules`**ï¼šè‹¥è¢«åˆ é™¤æˆ–æ¸…ç©ºï¼Œç«‹å³ä» `.rules` æ¢å¤ï¼ˆ`cp .rules .cursorrules`ï¼‰æˆ–æŒ‰ `.rules` å†…å®¹é‡å»º
- **`.rules`**ï¼š`.cursorrules` çš„å¤‡ä»½ï¼›ä¿®æ”¹ `.cursorrules` æ—¶é¡»åŒæ­¥æ›´æ–° `.rules`
- **`.gitignore`**ï¼šä¸å¾—åˆ é™¤ï¼›è‹¥è¯¯åˆ ï¼Œæ‰§è¡Œ `git restore .gitignore` æ¢å¤
- **`scripts/git-sync.sh`**ï¼šè‹¥ä¸¢å¤±ï¼Œç«‹å³ `cp docs/git-sync.sh.backup scripts/git-sync.sh && chmod +x scripts/git-sync.sh`ï¼Œç„¶åæ‰§è¡Œ push

## 4. é€‚ç”¨èŒƒå›´

`tanmai/` åŠå…¶å­ç›®å½•ï¼ˆbackendã€wx-miniã€frontend ç­‰ï¼‰ã€‚ä¸Šè¿°è·¯å¾„å†…çš„å®è´¨æ€§æ”¹åŠ¨å‡éœ€éµå¾ªæœ¬è§„åˆ™ã€‚

## 5. æœåŠ¡å™¨ Apache é…ç½®ï¼ˆwww.pengyoo.comï¼‰â€” å¿…é¡»è¿› git + å®ˆæŠ¤

- **é…ç½®æºæ–‡ä»¶ï¼ˆä»¥ repo ä¸ºå‡†ï¼‰**ï¼š`tanmai/deploy/apache/pengyoo-ssl.conf`ã€`tanmai/deploy/apache/http-redirect.conf`
- **ç¦æ­¢**åªåœ¨æœåŠ¡å™¨ä¸Šæ”¹ `/etc/httpd/conf.d/` è€Œä¸æ›´æ–° repoã€‚æ­£ç¡®æµç¨‹ï¼š
  1. åœ¨ **tanmai/deploy/apache/** ä¸‹ä¿®æ”¹å¯¹åº” `.conf`
  2. `git add` å¹¶ `git commit`ï¼Œæ‰§è¡Œ `./scripts/git-sync.sh push`
  3. åœ¨æœåŠ¡å™¨ä¸Šï¼š`sudo cp tanmai/deploy/apache/*.conf /etc/httpd/conf.d/` ä¸” `sudo systemctl reload httpd`
- **å®ˆæŠ¤**ï¼šæœåŠ¡å™¨ä¸Šåº”é…ç½® cron æ¯ 5 åˆ†é’Ÿæ‰§è¡Œ `tanmai/deploy/guard-apache-config.sh`ï¼ˆrootï¼‰ã€‚ä¸€æ—¦æ£€æµ‹åˆ° `/etc/httpd/conf.d/` ä¸‹é…ç½®ä¸ repo ä¸ä¸€è‡´ï¼Œä¼šå‘Šè­¦ï¼ˆlogger æ ‡ç­¾ `pengyoo-apache-guard`ï¼‰å¹¶è‡ªåŠ¨æ¢å¤ä¸º repo ç‰ˆæœ¬å¹¶é‡è½½ Apacheã€‚è¯¦è§ `tanmai/deploy/README.md`ã€‚
- è‹¥ä¿®æ”¹äº† Apache ç›¸å…³é…ç½®ï¼ˆå« SSLã€API åå‘ä»£ç†ï¼‰ï¼Œå¿…é¡»åŒæ­¥æ›´æ–° **deploy/apache/** å¹¶æäº¤ã€æ¨é€ï¼Œå¹¶ç¡®ä¿å®ˆæŠ¤è„šæœ¬å·²éƒ¨ç½²ã€‚
