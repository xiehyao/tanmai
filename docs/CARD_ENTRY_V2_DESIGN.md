# 填写名片 V2 设计方案

## 一、目标与原则

### 保留原版
- **原页面** `card-entry` 不动，作为可随时回退的稳定版本
- **新页面** 新建 `card-entry-v2`，在此做实验性优化

### 核心问题
- 用户感觉「查户口」、压力大
- 看不到填写带来的价值
- 碎片化字段多，填写负担重

### 设计原则
1. **价值前置**：每步先说清「填了会怎样」「对你有何好处」
2. **所见即所得**：填写时上半屏实时预览，降低心理门槛
3. **自然输入**：支持一大段自由书写 + AI 解析，也支持结构化字段
4. **双模式切换**：单输入框 / 多字段可切换，数据不丢失

---

## 二、外部入口与默认标签（灰度拉新）

### 业务背景

- **首批场景**：惠安一中（初中、高中）校友会、北京邮电大学深港澳校友会
- **拉新方式**：配置好的入口链接，用户从该入口进入即默认带校友会标签
- **扩展场景**：泉州商会、金融行业聚会、AI 沙龙等，同样模式——入口即带预置标签

### 入口与标签的联动

| 入口类型 | 示例 | 默认预置标签 |
|----------|------|--------------|
| 惠安一中校友会 | 小程序码 / 分享链接 | 惠安一中（初中/高中） |
| 北邮深港澳校友会 | 小程序码 / 分享链接 | 北邮深港澳校友会 |
| 泉州商会 | 活动 / 群分享链接 | 泉州商会 |
| 金融行业聚会 | 活动链接 | 金融行业 |
| AI 沙龙 | 活动链接 | AI 行业 / 兴趣 |

### 技术实现

**1. 入口参数传递**

- 小程序：`scene`（扫码）、`query`（分享链接）携带 `from=huian1z`、`from=bupt_sg`、`from=quanzhou_chamber` 等
- 后端：登录/首次进入时，根据 `from` 解析并写入用户 `entry_source` 或 `default_tags`

**2. 内部页面展现**

- **首页 / 导航**：展示「您来自惠安一中校友会」或「惠安一中 × 北邮深港澳」等徽章/标签，强化归属感
- **填写名片**：步骤 3「校友/同乡/同好发现」、步骤 5「社团参与」中，**预填或预勾选**入口对应的标签，用户可确认或修改
- **发现 / 匹配**：优先展示同入口用户的动态、推荐，或提供「只看惠安一中校友」等筛选

**3. 数据模型**

- 用户表：`entry_source`（如 `huian1z`、`bupt_sg`）、`default_tags`（JSON 数组）
- 或独立表：`user_entry_context`，记录来源、首次进入时间、预置标签

### 页面联动示意

```
外部入口（配置好的链接/小程序码）
    ↓
scene/query 解析 → 写入 entry_source、default_tags
    ↓
┌─────────────────────────────────────────────────┐
│ 首页：展示「惠安一中校友会」徽章 / 欢迎语          │
├─────────────────────────────────────────────────┤
│ 填写名片 step3：学校/届别 预填「惠安一中」         │
│ 填写名片 step5：社团 预填「惠安一中校友会」        │
├─────────────────────────────────────────────────┤
│ 发现页：可选「只看惠安一中校友」                   │
└─────────────────────────────────────────────────┘
```

### 扩展性

- 后台配置「入口 → 预置标签」映射表，新增场景只需配新入口和标签，无需改业务逻辑
- 用户可拥有多个标签（如既是惠安一中又在北邮深港澳），支持多入口叠加

---

## 三、信息架构与步骤规划

### 确定：6 步结构

| 步骤 | 名称 | 核心内容 | 用户看到的价值 | 数据落库 |
|------|------|----------|----------------|----------|
| 1 | **我的名片** | 姓名、公司、职位、社团、微信号、手机、邮箱、地址、头像 | 正式场合展示；私密信息可设可见规则 | user_cards, user_locations |
| 2 | **个人简介** | 一段话介绍自己（星座、籍贯、母校、现职、爱好等）+ 照片 | 可转发到群、非正式场合的自我介绍卡片 | user_intro（raw + structured） |
| 3 | **校友/同乡/同好发现** | 学校、届别、专业、星座、生日、家乡、兴趣爱好 | 校友发现、匹配「同届/同校/同好」 | user_education, user_needs 部分 |
| 4 | **事业与资源** | 过往公司/项目/职位、现职、能提供什么、需要什么 | 前同事/同行发现、事业链接 | user_needs, user_resources |
| 5 | **社团参与** | 参与的组织、担任职位、是否愿意为校友会出力 | 社团贡献、担任职务、志愿支持 | user_association_info |
| 6 | **资源与需求** | 聚拢各环节出现的资源与需求，可补充、调整 | 强调「我能提供什么」「我需要什么」，用于匹配对接 | user_needs, user_resources（汇总） |

### 资源与需求的「聚拢」逻辑

- **各环节都可涉及**：名片、简介、事业、社团等步骤中，用户若写了资源或需求，AI 解析时一并抽取
- **第 6 步作用**：再次强调、归拢、展示用户在所有环节填写的资源与需求，用户可补充、修正、确认
- **不重复**：前序步骤已写入的，在第 6 步以「已填写」形式展示，用户只需确认或增补

### 隐私可见性（细项粒度）

各步骤下的**子项**均可单独设置可见范围，例如：

| 可见性 | 说明 |
|--------|------|
| 公开 | 任何人可见 |
| 不公开 | 仅自己可见，不对外展示 |
| 仅对好友公开 | 加好友/互换名片后可见 |
| 仅对校友公开 | 需为已认证校友可见 |

可落库为 `field_visibility` 结构，与现有设计兼容。

---

## 四、单步交互设计

### 通用布局

```
┌─────────────────────────────────────┐
│  【上半屏】预览 / 说明区（约 35–40%）   │
│  - 展示填写后的效果 demo               │
│  - 或用 1–2 句说明「填了会怎样」       │
├─────────────────────────────────────┤
│  【下半屏】填写区                      │
│  - 单输入框 / 多字段 可切换            │
│  - 切换时数据不丢失                    │
└─────────────────────────────────────┘
```

### 各步详情

#### 步骤 1：我的名片

- **上半屏**：名片卡片 demo，实时映射用户输入
- **文案**：如「您填写的名片将用于正式场合展示。手机、微信号、邮箱、地址可设为「加好友/互换名片后可见」」
- **填写区**：
  - 单输入：`姓名 公司 职位 任职社团 社团职位 微信号 手机 邮件 公司地址`（一行或多行）
  - 多字段：各字段独立输入
  - 头像：单独上传入口
- **AI 解析**：从单输入中抽取 name, company, title, wechat_id, phone, email, address 等

#### 步骤 2：个人简介

- **上半屏**：个人简介卡片 demo（类似朋友圈/群里的自我介绍卡片）
- **文案**：如「可转发到群、发给新朋友，用于非正式场合介绍自己」
- **示例**：`白羊座；张坂人；惠安一中初97届 高00届；北京邮电大学 通信工程 00本04硕；腾讯 产品总监；北邮深港澳校友会执行秘书长；家在南山；喜欢羽毛球、爬山，对AI感兴趣，欢迎约喝茶`
- **填写区**：大文本框 + 照片上传，支持多行自由书写
- **AI 解析**：抽取星座、籍贯、学校、届别、专业、公司、职位、社团、爱好等，写入结构化表，同时保留原始文本

#### 步骤 3：校友/同乡/同好发现

- **上半屏**：标签云 / 校友匹配卡片 demo
- **文案**：如「用于校友发现与匹配：同届、同校、同好等」
- **填写区**：自由书写或结构化（学校、届别、专业、星座、生日、家乡、兴趣）
- **入口联动**：若用户从配置入口进入（如惠安一中、北邮深港澳），此处**预填**对应学校/社团标签，用户可确认或修改
- **AI 解析**：写入 user_education、user_needs 等

#### 步骤 4：事业与资源

- **上半屏**：事业履历 / 资源卡片 demo
- **文案**：如「用于前同事、同行发现，以及资源对接」
- **填写区**：公司、项目、职位、现职、能提供什么、需要什么
- **AI 解析**：写入 user_needs、user_resources

#### 步骤 5：社团参与

- **上半屏**：社团贡献卡片 demo
- **文案**：如「用于展示您在社团中的角色与贡献」
- **填写区**：参与组织、职位、是否愿意提供支持
- **入口联动**：若用户从校友会等入口进入，此处**预填**对应社团（如惠安一中校友会、北邮深港澳校友会），用户可确认或修改
- **AI 解析**：写入 user_association_info

#### 步骤 6：资源与需求

- **上半屏**：资源与需求汇总卡片 demo
- **文案**：如「聚拢您在各环节填写的资源与需求，用于匹配对接。可补充或调整」
- **填写区**：展示前序步骤已解析出的资源/需求，可编辑、补充；或自由书写一段，AI 补充解析
- **AI 解析**：合并写入 user_needs、user_resources

---

## 五、技术实现要点

### 前端

- 新页面：`pages/card-entry-v2/`（复制 card-entry 后改造）
- 上半屏：小程序内嵌预览组件，根据当前 step 和 input 实时渲染
- 下半屏：单输入 / 多字段切换，状态同步
- 不修改原 card-entry 的任何逻辑与接口

### 后端

- **原则**：优先复用现有接口，不破坏原逻辑
- **新增**（若需要）：
  - `POST /api/card-entry-v2/parse`：传入原始文本，返回 AI 解析后的结构化对象
  - 或扩展现有 `save-step` 支持 `raw_text` 字段，后端内部做解析
- **存储**：新增 `user_intro` 表或字段存原始简介；解析结果写入现有表

### AI 解析

- 输入：用户原始文本
- 输出：结构化 JSON（映射到 user_cards、user_education、user_needs 等）
- 模型：DeepSeek 或现有 LLM 服务
- 需设计 prompt，保证字段映射稳定、可追溯

### AI 解析成本分析（实时 vs 保存时）

**单次解析量级**：

- 输入：用户一段话 50–200 字 ≈ 50–200 tokens
- 输出：结构化 JSON，20–50 个字段 ≈ 100–300 tokens
- 单次约 200–500 tokens

**按 DeepSeek 官网价（约 1 元/百万 input、2 元/百万 output）**：

- 单次解析成本 ≈ 0.0002–0.001 元

**两种策略对比**：

| 策略 | 触发时机 | 单用户单次完整填写（6 步） | 估算成本 |
|------|----------|----------------------------|----------|
| 保存时解析 | 每步点「下一步/保存」时 | 6 次 | < 0.01 元 |
| 实时解析 | debounce 2–3 秒后 | 每步 2–4 次 × 6 步 ≈ 12–24 次 | < 0.02 元 |

**结论**：即使用实时解析，成本也极低，完全可控。输入输出都短、输出结构化，token 消耗小。若对体验要求高，可放心用实时解析；若优先省成本，保存时解析即可。

---

## 六、实施节奏建议

| 阶段 | 内容 |
|------|------|
| 1 | 确认步骤结构（已定 6 步）与各步内容 |
| 2 | **入口与标签**：scene/query 解析、entry_source/default_tags 落库、后台配置「入口→预置标签」 |
| 3 | 新建 card-entry-v2 页面骨架，实现通用布局（上预览 + 下输入） |
| 4 | 实现步骤 1「我的名片」完整闭环（含预览、单/多输入切换、细项可见性、保存） |
| 5 | 后端增加 AI 解析接口或扩展 save-step |
| 6 | 步骤 2–6 逐步实现，step3/5 支持入口预填 |
| 7 | 首页等展示入口归属标签；与现有匹配、发现等能力打通 |

---

## 七、已确认事项

- **6 步**：名片 → 简介 → 校友/同乡/同好发现 → 事业与资源 → 社团参与 → 资源与需求
- **资源与需求**：独立一步，聚拢各环节已填内容，可补充调整
- **细项可见性**：公开 / 不公开 / 仅对好友公开 / 仅对校友公开
- **AI 成本**：可控，实时解析与保存时解析均可
- **入口与默认标签**：外部入口（惠安一中、北邮深港澳等）携带 scene/query，用户默认带标签；填写页 step3/5 预填，首页等展示归属感
