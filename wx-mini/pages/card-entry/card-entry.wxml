<!--pages/card-entry/card-entry.wxml-->
<view class="card-entry-page">
  <!-- å·¥ä½œäººå‘˜æ¨¡å¼åˆ‡æ¢ -->
  <view class="staff-mode-bar">
    <view class="staff-toggle-row">
      <view class="staff-toggle" bindtap="toggleStaffMode">
        <text class="toggle-label">{{isStaffMode ? 'å·¥ä½œäººå‘˜æ¨¡å¼' : 'æ™®é€šæ¨¡å¼'}}</text>
        <switch checked="{{isStaffMode}}" color="#667eea" />
      </view>
      <!-- æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ï¼ˆä»…åœ¨å·¥ä½œäººå‘˜æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰ -->
      <view class="mode-tabs" wx:if="{{isStaffMode}}">
        <text 
          class="mode-tab {{!isInternalMode ? 'active' : ''}}" 
          bindtap="switchToFillMode"
        >ä»£å¡«ä¿¡æ¯</text>
        <text class="mode-tab-separator">|</text>
        <text 
          class="mode-tab {{isInternalMode ? 'active' : ''}}" 
          bindtap="switchToInternalMode"
        >å¡«å†™è¯„ä»·</text>
      </view>
    </view>
    
    <!-- ä»£å¡«æé†’è¯´æ˜ï¼ˆä»£å¡«ä¿¡æ¯æ¨¡å¼ä¸”æœªé€‰æ‹©ç›®æ ‡ç”¨æˆ·ä¸”éæ–°å¢æ¨¡å¼æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="staff-fill-notice" wx:if="{{isStaffMode && !isInternalMode && !targetUser && !staffAddNewMode}}">
      <text class="notice-icon">âš ï¸</text>
      <text class="notice-text">ä»£å¡«ä¿¡æ¯å°†è¢«æ ¡å‹æœ¬äººåŠä»–äººçœ‹åˆ°ï¼Œä¼šæ˜¾ç¤ºã€Œï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰ã€å¤‡æ³¨ï¼Œç³»ç»Ÿä¼šè®°å½•æ‚¨çš„æ“ä½œ</text>
    </view>
    
    <!-- å†…éƒ¨æ¨¡å¼æç¤ºï¼ˆå¡«å†™è¯„ä»·æ¨¡å¼ä¸”æœªé€‰æ‹©ç›®æ ‡ç”¨æˆ·æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="internal-mode-notice" wx:if="{{isInternalMode && !targetUser}}">
      <text class="notice-icon">ğŸ”’</text>
      <text class="notice-text">å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ‚¨å¡«å†™çš„ä¿¡æ¯ä»…ç”¨äºåŒ¹é…å’Œé£é™©æ§åˆ¶ï¼Œä¸ä¼šå‘æ ¡å‹æœ¬äººæˆ–ä»–äººå…¬å¼€</text>
    </view>
    
    <!-- ç”¨æˆ·æœç´¢ï¼ˆå·¥ä½œäººå‘˜æ¨¡å¼ æˆ– å†…éƒ¨è¾…è¯æ¨¡å¼ï¼‰ -->
    <view class="user-search-section" wx:if="{{isStaffMode || isInternalMode}}">
      <!-- æ–°å¢æ¨¡å¼ï¼šç©ºç™½å¡«å†™ -->
      <view class="selected-user add-new-mode" wx:if="{{staffAddNewMode}}">
        <text class="selected-label">æ–°å¢æ ¡å‹</text>
        <view class="selected-user-info">
          <text class="user-name">å¡«å†™åå°†åˆ›å»ºæ–°ç”¨æˆ·</text>
          <text class="clear-btn" bindtap="cancelStaffAddNew">å–æ¶ˆ</text>
        </view>
        <view class="selected-user-notice">
          <text class="notice-icon-small">âš ï¸</text>
          <text class="notice-text-small">ä»£å¡«ä¿¡æ¯å°†è¢«æ ¡å‹æœ¬äººåŠä»–äººçœ‹åˆ°ï¼Œä¼šæ˜¾ç¤ºã€Œï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰ã€å¤‡æ³¨</text>
        </view>
      </view>
      
      <!-- å·²é€‰æ‹©çš„ç›®æ ‡ç”¨æˆ· -->
      <view class="selected-user" wx:if="{{targetUser && !showUserSearch && !staffAddNewMode}}">
        <text class="selected-label">{{isInternalMode ? 'è¯„ä»·å¯¹è±¡ï¼š' : 'æ­£åœ¨ä¸ºä»¥ä¸‹ç”¨æˆ·å¡«å†™ï¼š'}}</text>
        <view class="selected-user-info">
          <text class="user-name">{{targetUser.name || targetUser.nickname}}</text>
          <text class="user-info" wx:if="{{targetUser.company}}">{{targetUser.company}}</text>
          <text class="clear-btn" bindtap="clearTargetUser">æ›´æ¢</text>
        </view>
        <!-- ä»£å¡«æé†’ï¼ˆå·¥ä½œäººå‘˜æ¨¡å¼ä¸”éå†…éƒ¨è¾…è¯ï¼‰ -->
        <view class="selected-user-notice" wx:if="{{isStaffMode && !isInternalMode}}">
          <text class="notice-icon-small">âš ï¸</text>
          <text class="notice-text-small">ä»£å¡«ä¿¡æ¯å°†è¢«è¯¥æ ¡å‹æœ¬äººåŠä»–äººçœ‹åˆ°ï¼Œä¼šæ˜¾ç¤ºã€Œï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰ã€å¤‡æ³¨ï¼Œç³»ç»Ÿä¼šè®°å½•æ‚¨çš„æ“ä½œ</text>
        </view>
        <!-- å†…éƒ¨æ¨¡å¼æç¤ºï¼ˆåœºæ™¯ä¸‰ï¼šä¸å…¬å¼€ï¼‰ -->
        <view class="selected-user-notice internal-notice" wx:if="{{isInternalMode}}">
          <text class="notice-icon-small">ğŸ”’</text>
          <text class="notice-text-small">å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ­¤ä¿¡æ¯ä»…ç”¨äºåŒ¹é…å’Œé£é™©æ§åˆ¶ï¼Œä¸ä¼šå‘æ ¡å‹æœ¬äººæˆ–ä»–äººå…¬å¼€</text>
        </view>
      </view>
      
      <!-- ç”¨æˆ·æœç´¢æ¡† + æ–°å¢ -->
      <view class="search-box" wx:if="{{(!targetUser || showUserSearch) && !staffAddNewMode}}">
        <input 
          class="search-input" 
          placeholder="æœç´¢ç”¨æˆ·å§“åæˆ–æ˜µç§°..."
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          confirm-type="search"
          bindconfirm="searchUsers"
        />
        <text class="search-btn" bindtap="searchUsers">æœç´¢</text>
        <text class="add-btn" wx:if="{{isStaffMode && !isInternalMode}}" bindtap="onStaffAddNew">æ–°å¢</text>
      </view>
      
      <!-- æœç´¢ç»“æœ -->
      <view class="search-results" wx:if="{{searchResults.length > 0 && (!targetUser || showUserSearch) && !staffAddNewMode}}">
        <view 
          class="user-item" 
          wx:for="{{searchResults}}" 
          wx:key="id"
          data-user-id="{{item.id}}"
          data-user-name="{{item.name}}"
          data-user-nickname="{{item.nickname}}"
          data-user-company="{{item.company}}"
          data-user-title="{{item.title}}"
          bindtap="selectTargetUser"
        >
          <text class="user-name">{{item.name || item.nickname}}</text>
          <text class="user-info" wx:if="{{item.company}}">{{item.company}}</text>
          <text class="user-info" wx:if="{{item.title}}">{{item.title}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ï¼ˆå†…éƒ¨è¾…è¯æ¨¡å¼é¡»å…ˆé€‰ç›®æ ‡ç”¨æˆ·ï¼‰ -->
  <view class="step-indicator" wx:if="{{!isInternalMode || (targetUser && targetUser.id)}}">
    <view 
      class="step-item {{index < currentStep ? 'completed' : ''}} {{currentStep === step ? 'current' : ''}}"
      wx:for="{{[1,2,3,4,5,6]}}" 
      wx:key="index"
      wx:for-item="step"
      wx:for-index="index"
      data-step="{{step}}"
      bindtap="goToStep"
    >
      <view class="step-number">{{step}}</view>
      <view class="step-label">
        <text wx:if="{{step === 1}}">åŸºç¡€</text>
        <text wx:if="{{step === 2}}">æ•™è‚²</text>
        <text wx:if="{{step === 3}}">éœ€æ±‚</text>
        <text wx:if="{{step === 4}}">èµ„æº</text>
        <text wx:if="{{step === 5}}">æ ¡å‹ä¼š</text>
        <text wx:if="{{step === 6}}">è¡¥å……</text>
      </view>
    </view>
  </view>

  <!-- è¡¨å•å†…å®¹ï¼ˆå†…éƒ¨è¾…è¯æ¨¡å¼é¡»å…ˆé€‰ç›®æ ‡ç”¨æˆ·ï¼‰ -->
  <scroll-view class="form-container" scroll-y wx:if="{{!isInternalMode || (targetUser && targetUser.id)}}">
    <!-- æ­¥éª¤1ï¼šåŸºç¡€ä¸åç‰‡ + ä½ç½®ä¿¡æ¯ -->
    <view class="step-content" wx:if="{{currentStep === 1}}">
      <view class="step-title">åŸºç¡€ä¿¡æ¯ä¸åç‰‡</view>
      
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">çœŸå®å§“å <text class="required">*</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.name === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.name === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" placeholder="è¯·è¾“å…¥çœŸå®å§“å" value="{{step1.name}}" data-step="1" data-field="name" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.name === 'private' ? 1 : (step1.field_visibility.name === 'masked' ? 2 : 0)}}" data-step="1" data-field="name" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.name === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.name === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">çœŸå®å§“å <text class="required">*</text></text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.name ? step1._original.name : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.name}}" data-step="1" data-field="name" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">å¾®ä¿¡æ˜µç§°<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.nickname === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.nickname === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" placeholder="è¯·è¾“å…¥å¾®ä¿¡æ˜µç§°" value="{{step1.nickname}}" data-step="1" data-field="nickname" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.nickname === 'private' ? 1 : (step1.field_visibility.nickname === 'masked' ? 2 : 0)}}" data-step="1" data-field="nickname" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.nickname === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.nickname === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">å¾®ä¿¡æ˜µç§°</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.nickname ? step1._original.nickname : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.nickname}}" data-step="1" data-field="nickname" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">å‡ºç”Ÿåœ°<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.birth_place === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.birth_place === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" placeholder="å¦‚ï¼šç¦å»ºçœæ³‰å·å¸‚æƒ å®‰å¿" value="{{step1.birth_place}}" data-step="1" data-field="birth_place" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.birth_place === 'private' ? 1 : (step1.field_visibility.birth_place === 'masked' ? 2 : 0)}}" data-step="1" data-field="birth_place" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.birth_place === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.birth_place === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">å‡ºç”Ÿåœ°</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.birth_place ? step1._original.birth_place : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.birth_place}}" data-step="1" data-field="birth_place" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group" wx:if="{{!isInternalMode}}">
        <text class="label">æ€§åˆ«</text>
        <picker mode="selector" range="{{genderOptions}}" range-key="label" value="{{step1._genderIndex}}" data-step="1" data-field="gender" bindchange="onGenderChange">
          <view class="picker">{{step1._genderLabel || 'è¯·é€‰æ‹©æ€§åˆ«'}}</view>
        </picker>
      </view>
      <view class="form-group" wx:if="{{!isInternalMode}}">
        <text class="label">å¾®ä¿¡å·</text>
        <input class="input" placeholder="é€‰å¡«ï¼Œç”¨äºæ ¡å‹åŠ å‹" value="{{step1.wechat_id}}" data-step="1" data-field="wechat_id" bindinput="onInputChange" />
      </view>
      <view class="form-group" wx:if="{{!isInternalMode}}">
        <text class="label">å±•ç¤ºå¤´åƒ</text>
        <text class="avatar-hint">æ ¹æ®æ€§åˆ«ä»…æ˜¾ç¤ºå¯¹åº”å¤´åƒï¼›ç‚¹å‡»ä¸‹æ–¹å¤´åƒé€‰æ‹©</text>
        <view class="avatar-current-wrap">
          <image class="avatar-current-img" src="{{step1.display_avatar || step1.selected_avatar || step1.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png'}}" mode="aspectFill" />
          <text class="avatar-current-label">{{step1._selectedAvatarLabel || 'ä½¿ç”¨å¾®ä¿¡å¤´åƒ'}}</text>
        </view>
        <scroll-view scroll-y class="avatar-select-scroll" style="max-height: 360rpx;">
          <view class="avatar-select-grid">
            <view class="avatar-option-wrap {{step1.selected_avatar === item.value ? 'avatar-option-selected' : ''}}" wx:for="{{filteredAvatarOptions}}" wx:key="value" data-value="{{item.value}}" data-label="{{item.label}}" bindtap="onAvatarImageTap">
              <image class="avatar-option-img" src="{{item.value ? item.value : (step1.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png')}}" mode="aspectFill" />
            </view>
          </view>
        </scroll-view>
      </view>
      <view class="form-group" wx:if="{{!isInternalMode}}">
        <text class="label">ä¸ªäººç…§ç‰‡ï¼ˆå¯å¤šå¼ ï¼Œä¸Šä¼ åå­˜æœåŠ¡å™¨ï¼‰</text>
        <view class="personal-photos-row">
          <view class="personal-photo-item" wx:for="{{step1.personal_photos}}" wx:key="*this">
            <image class="personal-photo-img" src="{{item}}" mode="aspectFill" />
            <text class="personal-photo-remove" data-index="{{index}}" bindtap="removePersonalPhoto">åˆ é™¤</text>
          </view>
          <view class="personal-photo-add" bindtap="addPersonalPhoto">
            <text class="add-text">+ æ·»åŠ ç…§ç‰‡</text>
          </view>
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">èŒä½/å¤´è¡”<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.title === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.title === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" placeholder="å¦‚ï¼šäº§å“ä¸“å®¶ã€æ‰§è¡Œç§˜ä¹¦é•¿" value="{{step1.title}}" data-step="1" data-field="title" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.title === 'private' ? 1 : (step1.field_visibility.title === 'masked' ? 2 : 0)}}" data-step="1" data-field="title" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.title === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.title === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">èŒä½/å¤´è¡”</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.title ? step1._original.title : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.title}}" data-step="1" data-field="title" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">å…¬å¸åç§° <text class="required">*</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.company === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.company === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" placeholder="è¯·è¾“å…¥å…¬å¸åç§°" value="{{step1.company}}" data-step="1" data-field="company" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.company === 'private' ? 1 : (step1.field_visibility.company === 'masked' ? 2 : 0)}}" data-step="1" data-field="company" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.company === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.company === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">å…¬å¸åç§° <text class="required">*</text></text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.company ? step1._original.company : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.company}}" data-step="1" data-field="company" bindinput="onInputChange" />
        </view>
      </view>

      <view class="section-title">ä½ç½®/åœ°å€</view>
      <view class="form-group" wx:for="{{step1.locations}}" wx:key="index" wx:for-item="loc" wx:for-index="locIndex">
        <view class="item-header">
          <text class="item-title">ä½ç½® {{locIndex + 1}}<text class="fill-remark" wx:if="{{!isInternalMode && loc.source === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && loc.source === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
          <text class="btn-remove" data-index="{{locIndex}}" bindtap="removeLocation">åˆ é™¤</text>
        </view>
        <picker mode="selector" range="{{locationTypeOptions}}" range-key="label" value="{{loc._typeIndex >= 0 ? loc._typeIndex : 0}}" data-step="1" data-field="location_type" data-loc-index="{{locIndex}}" bindchange="onLocationTypeChange">
          <view class="picker">{{loc._typeLabel || 'è¯·é€‰æ‹©ä½ç½®ç±»å‹'}}</view>
        </picker>
        <view class="address-input-wrapper">
          <input 
            class="input" 
            placeholder="è¯¦ç»†åœ°å€ï¼ˆè¾“å…¥å°åŒº/å¤§å¦åç§°å¯æ™ºèƒ½æç¤ºï¼‰" 
            value="{{loc.address}}" 
            data-step="1" 
            data-field="address" 
            data-loc-index="{{locIndex}}" 
            bindinput="onLocationInputChange"
            bindfocus="onLocationInputFocus"
            bindblur="onLocationInputBlur"
          />
          <view 
            class="address-suggestions" 
            wx:if="{{showAddressSuggestions[locIndex] && addressSuggestions[locIndex] && addressSuggestions[locIndex].length > 0}}"
          >
            <view 
              class="suggestion-item" 
              wx:for="{{addressSuggestions[locIndex]}}" 
              wx:key="index"
              wx:for-index="sugIndex"
              data-loc-index="{{locIndex}}"
              data-index="{{sugIndex}}"
              bindtap="onSelectAddressSuggestion"
            >
              <view class="suggestion-title">{{item.title}}</view>
              <view class="suggestion-address">{{item.address}}</view>
            </view>
          </view>
        </view>
        <view class="visibility-row">
          <text class="visibility-label">å¯è§æ€§</text>
          <picker mode="selector" range="{{locationVisibilityOptions}}" range-key="label" value="{{loc._visibilityIndex >= 0 ? loc._visibilityIndex : 0}}" data-loc-index="{{locIndex}}" bindchange="onLocationVisibilityChange">
            <view class="picker">{{loc._visibilityLabel || 'å…¬å¼€'}}</view>
          </picker>
        </view>
      </view>
      <button class="btn-add" bindtap="addLocation">+ æ·»åŠ ä½ç½®</button>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">ç”µè¯<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.phone === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.phone === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" type="number" placeholder="è¯·è¾“å…¥ç”µè¯å·ç " value="{{step1.phone}}" data-step="1" data-field="phone" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.phone === 'private' ? 1 : (step1.field_visibility.phone === 'masked' ? 2 : 0)}}" data-step="1" data-field="phone" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.phone === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.phone === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">ç”µè¯</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.phone ? step1._original.phone : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" type="number" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.phone}}" data-step="1" data-field="phone" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">é‚®ç®±<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.email === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.email === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input class="input" type="text" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" value="{{step1.email}}" data-step="1" data-field="email" bindinput="onInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.email === 'private' ? 1 : (step1.field_visibility.email === 'masked' ? 2 : 0)}}" data-step="1" data-field="email" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.email === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.email === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">é‚®ç®±</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.email ? step1._original.email : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <input class="input input-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.email}}" data-step="1" data-field="email" bindinput="onInputChange" />
        </view>
      </view>
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">ä¸ªäººç®€ä»‹<text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.bio === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{step1.field_source && step1.field_source.bio === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <textarea class="textarea" placeholder="ç®€å•ä»‹ç»ä¸€ä¸‹è‡ªå·±..." value="{{step1.bio}}" data-step="1" data-field="bio" bindinput="onInputChange" maxlength="500" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step1.field_visibility.bio === 'private' ? 1 : (step1.field_visibility.bio === 'masked' ? 2 : 0)}}" data-step="1" data-field="bio" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step1.field_visibility.bio === 'private' ? 'ä¸å…¬å¼€' : (step1.field_visibility.bio === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>
      <!-- å†…éƒ¨è¯„ä»·æ¨¡å¼ï¼šæ˜¾ç¤ºåŸå§‹æ•°æ®å’Œè¯„ä»·è¾“å…¥æ¡† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">ä¸ªäººç®€ä»‹</text>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">{{step1._original && step1._original.bio ? step1._original.bio : 'ï¼ˆæœªå¡«å†™ï¼‰'}}</text>
          </view>
          <textarea class="textarea textarea-internal" placeholder="è¯„ä»·/å¤‡æ³¨" value="{{step1.bio}}" data-step="1" data-field="bio" bindinput="onInputChange" maxlength="500" />
        </view>
      </view>

      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>

    <!-- æ­¥éª¤2ï¼šæ•™è‚²ç»å† -->
    <view class="step-content" wx:if="{{currentStep === 2}}">
      <view class="step-title">æ•™è‚²ç»å†</view>
      
      <!-- éå†…éƒ¨è¯„ä»·ï¼šç›´æ¥ç¼–è¾‘æ ¡å‹è‡ªå·±çš„å°å­¦ä¿¡æ¯ -->
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">å°å­¦</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥å°å­¦å­¦æ ¡åç§°"
          value="{{step2.primary_school}}"
          data-step="2"
          data-field="primary_school"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.primary_school === 'private' ? 1 : (step2.field_visibility.primary_school === 'masked' ? 2 : 0)}}" data-step="2" data-field="primary_school" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.primary_school === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.primary_school === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.primary_graduation_year}}"
          data-step="2"
          data-field="primary_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.primary_graduation_year === 'private' ? 1 : (step2.field_visibility.primary_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="primary_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.primary_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.primary_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šå·¦ä¾§ä¸ºæ ¡å‹åŸå§‹å°å­¦ä¿¡æ¯ï¼Œå³ä¾§ä¸ºå·¥ä½œäººå‘˜è¯„ä»·/å¤‡æ³¨ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">å°å­¦</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.primary_school ? step2._original.primary_school : 'ï¼ˆæœªå¡«å†™ï¼‰'}}
              <block wx:if="{{step2._original && step2._original.primary_graduation_year}}">ï¼ˆ{{step2._original.primary_graduation_year}} å¹´æ¯•ä¸šï¼‰</block>
            </text>
          </view>
          <view class="internal-field-column">
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·/å¤‡æ³¨æˆ–ä¿®æ­£åçš„å°å­¦åç§°"
              value="{{step2.primary_school}}"
              data-step="2"
              data-field="primary_school"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal input-year" 
              type="number"
              placeholder="è¯„ä»·ä¸­çš„æ¯•ä¸šå¹´ä»½"
              value="{{step2.primary_graduation_year}}"
              data-step="2"
              data-field="primary_graduation_year"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">åˆä¸­</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥åˆä¸­å­¦æ ¡åç§°"
          value="{{step2.middle_school}}"
          data-step="2"
          data-field="middle_school"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.middle_school === 'private' ? 1 : (step2.field_visibility.middle_school === 'masked' ? 2 : 0)}}" data-step="2" data-field="middle_school" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.middle_school === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.middle_school === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.middle_graduation_year}}"
          data-step="2"
          data-field="middle_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.middle_graduation_year === 'private' ? 1 : (step2.field_visibility.middle_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="middle_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.middle_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.middle_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šåˆä¸­ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">åˆä¸­</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.middle_school ? step2._original.middle_school : 'ï¼ˆæœªå¡«å†™ï¼‰'}}
              <block wx:if="{{step2._original && step2._original.middle_graduation_year}}">ï¼ˆ{{step2._original.middle_graduation_year}} å¹´æ¯•ä¸šï¼‰</block>
            </text>
          </view>
          <view class="internal-field-column">
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·/å¤‡æ³¨æˆ–ä¿®æ­£åçš„åˆä¸­åç§°"
              value="{{step2.middle_school}}"
              data-step="2"
              data-field="middle_school"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal input-year" 
              type="number"
              placeholder="è¯„ä»·ä¸­çš„æ¯•ä¸šå¹´ä»½"
              value="{{step2.middle_graduation_year}}"
              data-step="2"
              data-field="middle_graduation_year"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">é«˜ä¸­ <text class="recommended">æ¨è</text><text class="fill-remark" wx:if="{{!isInternalMode && step2.field_source && step2.field_source.high_school === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && step2.field_source && step2.field_source.high_school === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥é«˜ä¸­å­¦æ ¡åç§°"
          value="{{step2.high_school}}"
          data-step="2"
          data-field="high_school"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.high_school === 'private' ? 1 : (step2.field_visibility.high_school === 'masked' ? 2 : 0)}}" data-step="2" data-field="high_school" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.high_school === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.high_school === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.high_graduation_year}}"
          data-step="2"
          data-field="high_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.high_graduation_year === 'private' ? 1 : (step2.field_visibility.high_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="high_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.high_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.high_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šé«˜ä¸­ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">é«˜ä¸­ <text class="recommended">æ¨è</text></text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.high_school ? step2._original.high_school : 'ï¼ˆæœªå¡«å†™ï¼‰'}}
              <block wx:if="{{step2._original && step2._original.high_graduation_year}}">ï¼ˆ{{step2._original.high_graduation_year}} å¹´æ¯•ä¸šï¼‰</block>
            </text>
          </view>
          <view class="internal-field-column">
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·/å¤‡æ³¨æˆ–ä¿®æ­£åçš„é«˜ä¸­åç§°"
              value="{{step2.high_school}}"
              data-step="2"
              data-field="high_school"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal input-year" 
              type="number"
              placeholder="è¯„ä»·ä¸­çš„æ¯•ä¸šå¹´ä»½"
              value="{{step2.high_graduation_year}}"
              data-step="2"
              data-field="high_graduation_year"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">æœ¬ç§‘</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥å¤§å­¦åç§°"
          value="{{step2.bachelor_university}}"
          data-step="2"
          data-field="bachelor_university"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.bachelor_university === 'private' ? 1 : (step2.field_visibility.bachelor_university === 'masked' ? 2 : 0)}}" data-step="2" data-field="bachelor_university" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.bachelor_university === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.bachelor_university === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input" 
          placeholder="ä¸“ä¸š"
          value="{{step2.bachelor_major}}"
          data-step="2"
          data-field="bachelor_major"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.bachelor_major === 'private' ? 1 : (step2.field_visibility.bachelor_major === 'masked' ? 2 : 0)}}" data-step="2" data-field="bachelor_major" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.bachelor_major === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.bachelor_major === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.bachelor_graduation_year}}"
          data-step="2"
          data-field="bachelor_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.bachelor_graduation_year === 'private' ? 1 : (step2.field_visibility.bachelor_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="bachelor_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.bachelor_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.bachelor_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šæœ¬ç§‘ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æœ¬ç§‘</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.bachelor_university ? step2._original.bachelor_university : 'ï¼ˆæœªå¡«å†™å­¦æ ¡ï¼‰'}}
              <block wx:if="{{step2._original && step2._original.bachelor_major}}"> Â· {{step2._original.bachelor_major}}</block>
              <block wx:if="{{step2._original && step2._original.bachelor_graduation_year}}">ï¼ˆ{{step2._original.bachelor_graduation_year}} å¹´æ¯•ä¸šï¼‰</block>
            </text>
          </view>
          <view class="internal-field-column">
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·/å¤‡æ³¨æˆ–ä¿®æ­£åçš„å¤§å­¦åç§°"
              value="{{step2.bachelor_university}}"
              data-step="2"
              data-field="bachelor_university"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·ä¸­çš„ä¸“ä¸š"
              value="{{step2.bachelor_major}}"
              data-step="2"
              data-field="bachelor_major"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal input-year" 
              type="number"
              placeholder="è¯„ä»·ä¸­çš„æ¯•ä¸šå¹´ä»½"
              value="{{step2.bachelor_graduation_year}}"
              data-step="2"
              data-field="bachelor_graduation_year"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">ç¡•å£«</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥å¤§å­¦åç§°"
          value="{{step2.master_university}}"
          data-step="2"
          data-field="master_university"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.master_university === 'private' ? 1 : (step2.field_visibility.master_university === 'masked' ? 2 : 0)}}" data-step="2" data-field="master_university" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.master_university === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.master_university === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input" 
          placeholder="ä¸“ä¸š"
          value="{{step2.master_major}}"
          data-step="2"
          data-field="master_major"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.master_major === 'private' ? 1 : (step2.field_visibility.master_major === 'masked' ? 2 : 0)}}" data-step="2" data-field="master_major" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.master_major === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.master_major === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.master_graduation_year}}"
          data-step="2"
          data-field="master_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.master_graduation_year === 'private' ? 1 : (step2.field_visibility.master_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="master_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.master_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.master_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šç¡•å£« -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">ç¡•å£«</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.master_university ? step2._original.master_university : 'ï¼ˆæœªå¡«å†™å­¦æ ¡ï¼‰'}}
              <block wx:if="{{step2._original && step2._original.master_major}}"> Â· {{step2._original.master_major}}</block>
              <block wx:if="{{step2._original && step2._original.master_graduation_year}}">ï¼ˆ{{step2._original.master_graduation_year}} å¹´æ¯•ä¸šï¼‰</block>
            </text>
          </view>
          <view class="internal-field-column">
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·/å¤‡æ³¨æˆ–ä¿®æ­£åçš„å¤§å­¦åç§°"
              value="{{step2.master_university}}"
              data-step="2"
              data-field="master_university"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal" 
              placeholder="è¯„ä»·ä¸­çš„ä¸“ä¸š"
              value="{{step2.master_major}}"
              data-step="2"
              data-field="master_major"
              bindinput="onInputChange"
            />
            <input 
              class="input input-internal input-year" 
              type="number"
              placeholder="è¯„ä»·ä¸­çš„æ¯•ä¸šå¹´ä»½"
              value="{{step2.master_graduation_year}}"
              data-step="2"
              data-field="master_graduation_year"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">åšå£«</text>
        <input 
          class="input" 
          placeholder="è¯·è¾“å…¥å¤§å­¦åç§°"
          value="{{step2.doctor_university}}"
          data-step="2"
          data-field="doctor_university"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.doctor_university === 'private' ? 1 : (step2.field_visibility.doctor_university === 'masked' ? 2 : 0)}}" data-step="2" data-field="doctor_university" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.doctor_university === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.doctor_university === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input" 
          placeholder="ä¸“ä¸š"
          value="{{step2.doctor_major}}"
          data-step="2"
          data-field="doctor_major"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.doctor_major === 'private' ? 1 : (step2.field_visibility.doctor_major === 'masked' ? 2 : 0)}}" data-step="2" data-field="doctor_major" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.doctor_major === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.doctor_major === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          class="input input-year" 
          type="number"
          placeholder="æ¯•ä¸šå¹´ä»½"
          value="{{step2.doctor_graduation_year}}"
          data-step="2"
          data-field="doctor_graduation_year"
          bindinput="onInputChange"
        />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.doctor_graduation_year === 'private' ? 1 : (step2.field_visibility.doctor_graduation_year === 'masked' ? 2 : 0)}}" data-step="2" data-field="doctor_graduation_year" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.doctor_graduation_year === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.doctor_graduation_year === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">æœ€é«˜å­¦å† <text class="recommended">æ¨è</text></text>
        <picker 
          mode="selector" 
          range="{{degreeOptions}}"
          value="{{pickerIndexes.highestDegree >= 0 ? pickerIndexes.highestDegree : 0}}"
          data-step="2"
          data-field="highest_degree"
          bindchange="onPickerChange"
        >
          <view class="picker">
            {{pickerIndexes.highestDegreeLabel}}
          </view>
        </picker>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step2.field_visibility.highest_degree === 'private' ? 1 : (step2.field_visibility.highest_degree === 'masked' ? 2 : 0)}}" data-step="2" data-field="highest_degree" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step2.field_visibility.highest_degree === 'private' ? 'ä¸å…¬å¼€' : (step2.field_visibility.highest_degree === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šæœ€é«˜å­¦å† -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æœ€é«˜å­¦å† <text class="recommended">æ¨è</text></text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step2._original && step2._original.highest_degree ? step2._original.highest_degree : 'ï¼ˆæœªå¡«å†™ï¼‰'}}
            </text>
          </view>
          <view class="internal-field-column">
            <picker 
              mode="selector" 
              range="{{degreeOptions}}"
              value="{{pickerIndexes.highestDegree >= 0 ? pickerIndexes.highestDegree : 0}}"
              data-step="2"
              data-field="highest_degree"
              bindchange="onPickerChange"
            >
              <view class="picker">
                {{pickerIndexes.highestDegreeLabel}}
              </view>
            </picker>
          </view>
        </view>
      </view>

      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>

    <!-- æ­¥éª¤3ï¼šéœ€æ±‚ä¸çŠ¶æ€ -->
    <view class="step-content" wx:if="{{currentStep === 3}}">
      <view class="step-title">éœ€æ±‚ä¸çŠ¶æ€</view>
      
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">å©šå§»çŠ¶å†µ<text class="fill-remark" wx:if="{{!isInternalMode && step3.field_source && step3.field_source.marital_status === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && step3.field_source && step3.field_source.marital_status === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
        <picker 
          mode="selector" 
          range="{{maritalOptions}}"
          range-key="label"
          value="{{pickerIndexes.maritalStatus >= 0 ? pickerIndexes.maritalStatus : 0}}"
          data-step="3"
          data-field="marital_status"
          data-options="maritalOptions"
          bindchange="onPickerChange"
        >
          <view class="picker">
            {{pickerIndexes.maritalStatusLabel}}
          </view>
        </picker>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.marital_status === 'private' ? 1 : (step3.field_visibility.marital_status === 'masked' ? 2 : 0)}}" data-step="3" data-field="marital_status" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.marital_status === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.marital_status === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šå©šå§»çŠ¶å†µ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">å©šå§»çŠ¶å†µ</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step3._original && step3._original.marital_status_label ? step3._original.marital_status_label : (step3._original && step3._original.marital_status ? step3._original.marital_status : 'ï¼ˆæœªå¡«å†™ï¼‰')}}
            </text>
          </view>
          <view class="internal-field-column">
            <picker 
              mode="selector" 
              range="{{maritalOptions}}"
              range-key="label"
              value="{{pickerIndexes.maritalStatus >= 0 ? pickerIndexes.maritalStatus : 0}}"
              data-step="3"
              data-field="marital_status"
              data-options="maritalOptions"
              bindchange="onPickerChange"
            >
              <view class="picker">
                {{pickerIndexes.maritalStatusLabel}}
              </view>
            </picker>
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <view class="switch-row">
          <text class="label">æ˜¯å¦æœ‰ç›¸äº²éœ€æ±‚</text>
          <switch 
            checked="{{step3.dating_need}}"
            data-step="3"
            data-field="dating_need"
            bindchange="onSwitchChange"
          />
        </view>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.dating_need === 'private' ? 1 : (step3.field_visibility.dating_need === 'masked' ? 2 : 0)}}" data-step="3" data-field="dating_need" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.dating_need === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.dating_need === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <textarea 
          wx:if="{{step3.dating_need}}"
          class="textarea" 
          placeholder="è¯·æè¿°æ‚¨çš„ç›¸äº²åå¥½..."
          value="{{step3.dating_preferences}}"
          data-step="3"
          data-field="dating_preferences"
          bindinput="onInputChange"
        />
        <picker wx:if="{{step3.dating_need}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.dating_preferences === 'private' ? 1 : (step3.field_visibility.dating_preferences === 'masked' ? 2 : 0)}}" data-step="3" data-field="dating_preferences" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.dating_preferences === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.dating_preferences === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šç›¸äº²éœ€æ±‚ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æ˜¯å¦æœ‰ç›¸äº²éœ€æ±‚</text>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step3._original && step3._original.dating_need ? 'æœ‰ç›¸äº²éœ€æ±‚' : 'æ— ç›¸äº²éœ€æ±‚æˆ–æœªå¡«å†™'}}
            </text>
            <text class="original-text-inline" wx:if="{{step3._original && step3._original.dating_preferences}}">
              åå¥½ï¼š{{step3._original.dating_preferences}}
            </text>
          </view>
          <view class="internal-field-column">
            <view class="switch-row">
              <text class="label">è¯„ä»·ä¸­çš„ç›¸äº²éœ€æ±‚</text>
              <switch 
                checked="{{step3.dating_need}}"
                data-step="3"
                data-field="dating_need"
                bindchange="onSwitchChange"
              />
            </view>
            <textarea 
              class="textarea textarea-internal" 
              placeholder="å·¥ä½œäººå‘˜å¯¹ç›¸äº²éœ€æ±‚çš„å¤‡æ³¨/è¡¥å……"
              value="{{step3.dating_preferences}}"
              data-step="3"
              data-field="dating_preferences"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <view class="switch-row">
          <text class="label">æ˜¯å¦åœ¨æ‰¾å·¥ä½œ</text>
          <switch 
            checked="{{step3.job_seeking}}"
            data-step="3"
            data-field="job_seeking"
            bindchange="onSwitchChange"
          />
        </view>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.job_seeking === 'private' ? 1 : (step3.field_visibility.job_seeking === 'masked' ? 2 : 0)}}" data-step="3" data-field="job_seeking" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.job_seeking === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.job_seeking === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          wx:if="{{step3.job_seeking}}"
          class="input" 
          placeholder="ç›®æ ‡èŒä½"
          value="{{step3.job_target_position}}"
          data-step="3"
          data-field="job_target_position"
          bindinput="onInputChange"
        />
        <picker wx:if="{{step3.job_seeking}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.job_target_position === 'private' ? 1 : (step3.field_visibility.job_target_position === 'masked' ? 2 : 0)}}" data-step="3" data-field="job_target_position" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.job_target_position === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.job_target_position === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input 
          wx:if="{{step3.job_seeking}}"
          class="input" 
          placeholder="ç›®æ ‡è¡Œä¸š"
          value="{{step3.job_target_industry}}"
          data-step="3"
          data-field="job_target_industry"
          bindinput="onInputChange"
        />
        <picker wx:if="{{step3.job_seeking}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.job_target_industry === 'private' ? 1 : (step3.field_visibility.job_target_industry === 'masked' ? 2 : 0)}}" data-step="3" data-field="job_target_industry" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.job_target_industry === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.job_target_industry === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <textarea 
          wx:if="{{step3.job_seeking}}"
          class="textarea" 
          placeholder="å·¥ä½œåå¥½"
          value="{{step3.job_preferences}}"
          data-step="3"
          data-field="job_preferences"
          bindinput="onInputChange"
        />
        <picker wx:if="{{step3.job_seeking}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.job_preferences === 'private' ? 1 : (step3.field_visibility.job_preferences === 'masked' ? 2 : 0)}}" data-step="3" data-field="job_preferences" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.job_preferences === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.job_preferences === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šæ‰¾å·¥ä½œ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æ˜¯å¦åœ¨æ‰¾å·¥ä½œ</text>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step3._original && step3._original.job_seeking ? 'åœ¨æ‰¾å·¥ä½œ' : 'æœªåœ¨æ‰¾å·¥ä½œæˆ–æœªå¡«å†™'}}
            </text>
            <text class="original-text-inline" wx:if="{{step3._original && (step3._original.job_target_position || step3._original.job_target_industry || step3._original.job_preferences)}}">
              ç›®æ ‡ï¼š{{step3._original.job_target_position || 'ï¼ˆèŒä½æœªå¡«ï¼‰'}}ï¼Œè¡Œä¸šï¼š{{step3._original.job_target_industry || 'ï¼ˆè¡Œä¸šæœªå¡«ï¼‰'}}
            </text>
          </view>
          <view class="internal-field-column">
            <view class="switch-row">
              <text class="label">è¯„ä»·ä¸­çš„æ‰¾å·¥ä½œçŠ¶æ€</text>
              <switch 
                checked="{{step3.job_seeking}}"
                data-step="3"
                data-field="job_seeking"
                bindchange="onSwitchChange"
              />
            </view>
            <input 
              wx:if="{{step3.job_seeking}}"
              class="input input-internal" 
              placeholder="è¯„ä»·ä¸­çš„ç›®æ ‡èŒä½"
              value="{{step3.job_target_position}}"
              data-step="3"
              data-field="job_target_position"
              bindinput="onInputChange"
            />
            <input 
              wx:if="{{step3.job_seeking}}"
              class="input input-internal" 
              placeholder="è¯„ä»·ä¸­çš„ç›®æ ‡è¡Œä¸š"
              value="{{step3.job_target_industry}}"
              data-step="3"
              data-field="job_target_industry"
              bindinput="onInputChange"
            />
            <textarea 
              wx:if="{{step3.job_seeking}}"
              class="textarea textarea-internal" 
              placeholder="å·¥ä½œäººå‘˜å¯¹å…¶æ±‚èŒæƒ…å†µçš„å¤‡æ³¨/è¡¥å……"
              value="{{step3.job_preferences}}"
              data-step="3"
              data-field="job_preferences"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <view class="switch-row">
          <text class="label">æ˜¯å¦æœ‰åˆ›ä¸šéœ€æ±‚</text>
          <switch 
            checked="{{step3.entrepreneurship_need}}"
            data-step="3"
            data-field="entrepreneurship_need"
            bindchange="onSwitchChange"
          />
        </view>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.entrepreneurship_need === 'private' ? 1 : (step3.field_visibility.entrepreneurship_need === 'masked' ? 2 : 0)}}" data-step="3" data-field="entrepreneurship_need" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.entrepreneurship_need === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.entrepreneurship_need === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <picker 
          wx:if="{{step3.entrepreneurship_need}}"
          mode="selector" 
          range="{{entrepreneurshipTypeOptions}}"
          range-key="label"
          value="{{pickerIndexes.entrepreneurshipType >= 0 ? pickerIndexes.entrepreneurshipType : 0}}"
          data-step="3"
          data-field="entrepreneurship_type"
          data-options="entrepreneurshipTypeOptions"
          bindchange="onPickerChange"
        >
          <view class="picker">
            {{pickerIndexes.entrepreneurshipTypeLabel}}
          </view>
        </picker>
        <picker wx:if="{{step3.entrepreneurship_need}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.entrepreneurship_type === 'private' ? 1 : (step3.field_visibility.entrepreneurship_type === 'masked' ? 2 : 0)}}" data-step="3" data-field="entrepreneurship_type" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.entrepreneurship_type === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.entrepreneurship_type === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <textarea 
          wx:if="{{step3.entrepreneurship_need}}"
          class="textarea" 
          placeholder="è¯·æè¿°æ‚¨çš„åˆ›ä¸šéœ€æ±‚..."
          value="{{step3.entrepreneurship_description}}"
          data-step="3"
          data-field="entrepreneurship_description"
          bindinput="onInputChange"
        />
        <picker wx:if="{{step3.entrepreneurship_need}}" mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step3.field_visibility.entrepreneurship_description === 'private' ? 1 : (step3.field_visibility.entrepreneurship_description === 'masked' ? 2 : 0)}}" data-step="3" data-field="entrepreneurship_description" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step3.field_visibility.entrepreneurship_description === 'private' ? 'ä¸å…¬å¼€' : (step3.field_visibility.entrepreneurship_description === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šåˆ›ä¸šéœ€æ±‚ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æ˜¯å¦æœ‰åˆ›ä¸šéœ€æ±‚</text>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step3._original && step3._original.entrepreneurship_need ? 'æœ‰åˆ›ä¸šéœ€æ±‚' : 'æ— åˆ›ä¸šéœ€æ±‚æˆ–æœªå¡«å†™'}}
            </text>
            <text class="original-text-inline" wx:if="{{step3._original && (step3._original.entrepreneurship_type || step3._original.entrepreneurship_description)}}">
              ç±»å‹ï¼š{{step3._original.entrepreneurship_type || 'ï¼ˆç±»å‹æœªå¡«ï¼‰'}}
            </text>
          </view>
          <view class="internal-field-column">
            <view class="switch-row">
              <text class="label">è¯„ä»·ä¸­çš„åˆ›ä¸šéœ€æ±‚</text>
              <switch 
                checked="{{step3.entrepreneurship_need}}"
                data-step="3"
                data-field="entrepreneurship_need"
                bindchange="onSwitchChange"
              />
            </view>
            <picker 
              wx:if="{{step3.entrepreneurship_need}}"
              mode="selector" 
              range="{{entrepreneurshipTypeOptions}}"
              range-key="label"
              value="{{pickerIndexes.entrepreneurshipType >= 0 ? pickerIndexes.entrepreneurshipType : 0}}"
              data-step="3"
              data-field="entrepreneurship_type"
              data-options="entrepreneurshipTypeOptions"
              bindchange="onPickerChange"
            >
              <view class="picker">
                {{pickerIndexes.entrepreneurshipTypeLabel}}
              </view>
            </picker>
            <textarea 
              wx:if="{{step3.entrepreneurship_need}}"
              class="textarea textarea-internal" 
              placeholder="å·¥ä½œäººå‘˜å¯¹åˆ›ä¸šéœ€æ±‚çš„å¤‡æ³¨/è¡¥å……"
              value="{{step3.entrepreneurship_description}}"
              data-step="3"
              data-field="entrepreneurship_description"
              bindinput="onInputChange"
            />
          </view>
        </view>
      </view>

      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>

    <!-- æ­¥éª¤4ï¼šèµ„æºåˆ†äº« -->
    <view class="step-content" wx:if="{{currentStep === 4}}">
      <view class="step-title">èµ„æºåˆ†äº«</view>
      <view class="section-title">èµ„æºåˆ†äº«</view>

      <!-- éå†…éƒ¨è¯„ä»·ï¼šç›´æ¥ç¼–è¾‘èµ„æº -->
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}" wx:for="{{step4.resources}}" wx:key="index" wx:for-item="res" wx:for-index="resIndex">
        <view class="item-header">
          <text class="item-title">èµ„æº {{resIndex + 1}}<text class="fill-remark" wx:if="{{!isInternalMode && res.source === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && res.source === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
          <text class="btn-remove" data-index="{{resIndex}}" bindtap="removeResource">åˆ é™¤</text>
        </view>
        <picker mode="selector" range="{{resourceTypeOptions}}" range-key="label" value="{{res._typeIndex >= 0 ? res._typeIndex : 0}}" data-step="4" data-field="resource_type" data-res-index="{{resIndex}}" bindchange="onResourceTypeChange">
          <view class="picker">{{res._typeLabel || 'è¯·é€‰æ‹©èµ„æºç±»å‹'}}</view>
        </picker>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{res.field_visibility && res.field_visibility.resource_type === 'private' ? 1 : (res.field_visibility && res.field_visibility.resource_type === 'masked' ? 2 : 0)}}" data-step="4" data-field="resource_type" data-res-index="{{resIndex}}" bindchange="onResourceFieldVisibilityChange">
          <view class="visibility-picker">{{res.field_visibility && res.field_visibility.resource_type === 'private' ? 'ä¸å…¬å¼€' : (res.field_visibility && res.field_visibility.resource_type === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <input class="input" placeholder="èµ„æºæ ‡é¢˜" value="{{res.resource_title}}" data-step="4" data-field="resource_title" data-res-index="{{resIndex}}" bindinput="onResourceInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{res.field_visibility && res.field_visibility.resource_title === 'private' ? 1 : (res.field_visibility && res.field_visibility.resource_title === 'masked' ? 2 : 0)}}" data-step="4" data-field="resource_title" data-res-index="{{resIndex}}" bindchange="onResourceFieldVisibilityChange">
          <view class="visibility-picker">{{res.field_visibility && res.field_visibility.resource_title === 'private' ? 'ä¸å…¬å¼€' : (res.field_visibility && res.field_visibility.resource_title === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <textarea class="textarea" placeholder="èµ„æºæè¿°" value="{{res.resource_description}}" data-step="4" data-field="resource_description" data-res-index="{{resIndex}}" bindinput="onResourceInputChange" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{res.field_visibility && res.field_visibility.resource_description === 'private' ? 1 : (res.field_visibility && res.field_visibility.resource_description === 'masked' ? 2 : 0)}}" data-step="4" data-field="resource_description" data-res-index="{{resIndex}}" bindchange="onResourceFieldVisibilityChange">
          <view class="visibility-picker">{{res.field_visibility && res.field_visibility.resource_description === 'private' ? 'ä¸å…¬å¼€' : (res.field_visibility && res.field_visibility.resource_description === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
        <picker mode="selector" range="{{sharingModeOptions}}" range-key="label" value="{{res._modeIndex >= 0 ? res._modeIndex : 0}}" data-step="4" data-field="sharing_mode" data-res-index="{{resIndex}}" bindchange="onResourceTypeChange">
          <view class="picker">{{res._modeLabel || 'è¯·é€‰æ‹©åˆ†äº«æ–¹å¼'}}</view>
        </picker>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{res.field_visibility && res.field_visibility.sharing_mode === 'private' ? 1 : (res.field_visibility && res.field_visibility.sharing_mode === 'masked' ? 2 : 0)}}" data-step="4" data-field="sharing_mode" data-res-index="{{resIndex}}" bindchange="onResourceFieldVisibilityChange">
          <view class="visibility-picker">{{res.field_visibility && res.field_visibility.sharing_mode === 'private' ? 'ä¸å…¬å¼€' : (res.field_visibility && res.field_visibility.sharing_mode === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šèµ„æº -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}" wx:for="{{step4.resources}}" wx:key="index" wx:for-item="res" wx:for-index="resIndex">
        <view class="item-header">
          <text class="item-title">èµ„æº {{resIndex + 1}}</text>
        </view>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{(res._original && res._original.resource_title) || res.resource_title || 'ï¼ˆæœªå¡«å†™æ ‡é¢˜ï¼‰'}}
            </text>
            <text class="original-text-inline" wx:if="{{(res._original && res._original.resource_description) || res.resource_description}}">
              {{(res._original && res._original.resource_description) || res.resource_description}}
            </text>
          </view>
          <view class="internal-field-column">
            <textarea 
              class="textarea textarea-internal" 
              placeholder="å·¥ä½œäººå‘˜å¯¹è¯¥èµ„æºçš„è¯„ä»·/å¤‡æ³¨"
              value="{{res.staff_comment || ''}}"
              data-step="4"
              data-field="staff_comment"
              data-res-index="{{resIndex}}"
              bindinput="onResourceInputChange"
            />
          </view>
        </view>
      </view>

      <button class="btn-add" bindtap="addResource">+ æ·»åŠ èµ„æº</button>
      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>

    <!-- æ­¥éª¤5ï¼šæ ¡å‹ä¼š -->
    <view class="step-content" wx:if="{{currentStep === 5}}">
      <view class="step-title">æ ¡å‹ä¼šå‚ä¸</view>

      <!-- éå†…éƒ¨è¯„ä»·ï¼šç›´æ¥ç¼–è¾‘ -->
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <view class="switch-row">
          <text class="label">æ˜¯å¦æ„¿æ„ä¸ºæ ¡å‹ä¼šåšå·¥ä½œ<text class="fill-remark" wx:if="{{!isInternalMode && step5.field_source && step5.field_source.willing_to_serve === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && step5.field_source && step5.field_source.willing_to_serve === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></text>
          <switch checked="{{step5.willing_to_serve}}" data-step="5" data-field="willing_to_serve" bindchange="onSwitchChange" />
        </view>
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.willing_to_serve === 'private' ? 1 : (step5.field_visibility.willing_to_serve === 'masked' ? 2 : 0)}}" data-step="5" data-field="willing_to_serve" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step5.field_visibility.willing_to_serve === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.willing_to_serve === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šæ˜¯å¦æ„¿æ„ä¸ºæ ¡å‹ä¼šåšå·¥ä½œ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">æ˜¯å¦æ„¿æ„ä¸ºæ ¡å‹ä¼šåšå·¥ä½œ</text>
        <view class="internal-field-row">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step5._original && step5._original.willing_to_serve ? 'æ„¿æ„' : 'ä¸æ„¿æ„æˆ–æœªå¡«å†™'}}
            </text>
          </view>
          <view class="internal-field-column">
            <view class="switch-row">
              <text class="label">è¯„ä»·ä¸­çš„æ„æ„¿</text>
              <switch checked="{{step5.willing_to_serve}}" data-step="5" data-field="willing_to_serve" bindchange="onSwitchChange" />
            </view>
          </view>
        </view>
      </view>

      <block wx:if="{{step5.willing_to_serve}}">
        <view class="section-title">æƒ å®‰ä¸€ä¸­æ ¡è‘£ä¼šèŒåŠ¡ï¼ˆå•é€‰ï¼‰<text class="fill-remark" wx:if="{{!isInternalMode && step5.field_source && step5.field_source.board_position === 'staff'}}">ï¼ˆæ ¡å‹ä¼šä»£å¡«ï¼‰</text><text class="fill-remark" wx:if="{{!isInternalMode && step5.field_source && step5.field_source.board_position === 'alumni'}}">ï¼ˆå…¶å®ƒæ ¡å‹ä»£å¡«ï¼‰</text></view>
        <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
          <picker mode="selector" range="{{boardPositionOptions}}" range-key="label" value="{{pickerIndexes.boardPosition >= 0 ? pickerIndexes.boardPosition : 0}}" data-step="5" data-field="board_position" data-options="boardPositionOptions" bindchange="onBoardPositionChange">
            <view class="picker">{{pickerIndexes.boardPositionLabel || 'è¯·é€‰æ‹©'}}</view>
          </picker>
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.board_position === 'private' ? 1 : (step5.field_visibility.board_position === 'masked' ? 2 : 0)}}" data-step="5" data-field="board_position" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.board_position === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.board_position === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>

        <!-- å†…éƒ¨è¯„ä»·ï¼šæ ¡è‘£ä¼šèŒåŠ¡ -->
        <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
          <text class="label">æƒ å®‰ä¸€ä¸­æ ¡è‘£ä¼šèŒåŠ¡</text>
          <view class="internal-field-row">
            <view class="original-value-inline">
              <text class="original-text-inline">
                {{step5._original && step5._original.board_position_label ? step5._original.board_position_label : (pickerIndexes.boardPositionLabel || 'ï¼ˆæœªé€‰æ‹©ï¼‰')}}
              </text>
            </view>
            <view class="internal-field-column">
              <picker mode="selector" range="{{boardPositionOptions}}" range-key="label" value="{{pickerIndexes.boardPosition >= 0 ? pickerIndexes.boardPosition : 0}}" data-step="5" data-field="board_position" data-options="boardPositionOptions" bindchange="onBoardPositionChange">
                <view class="picker">{{pickerIndexes.boardPositionLabel || 'è¯·é€‰æ‹©'}}</view>
              </picker>
            </view>
          </view>
        </view>

        <view class="section-title">æƒ å®‰ä¸€ä¸­å¤§æ¹¾åŒºæ ¡å‹ä¼šèŒåŠ¡ï¼ˆå¯å¤šé€‰ï¼‰</view>
        <view class="form-group checkbox-group">
          <view class="checkbox-item" wx:for="{{pickerIndexes.associationPositionsWithChecked}}" wx:key="value" wx:for-item="opt">
            <checkbox value="{{opt.value}}" checked="{{opt.checked}}" bindtap="onAssociationPositionTap" data-value="{{opt.value}}" />
            <text>{{opt.label}}</text>
          </view>
        </view>
        <view class="form-group form-group-with-visibility">
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.association_positions === 'private' ? 1 : (step5.field_visibility.association_positions === 'masked' ? 2 : 0)}}" data-step="5" data-field="association_positions" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.association_positions === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.association_positions === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>
        <view class="section-title">å¯ä¸ºæ ¡å‹ä¼šæä¾›çš„æ”¯æŒï¼ˆå¯å¤šé€‰ï¼Œå¯å¡«è¯¦ç»†ï¼‰</view>
        <view class="form-group checkbox-group">
          <view class="checkbox-item" wx:for="{{pickerIndexes.supportTypesWithChecked}}" wx:key="value" wx:for-item="opt">
            <checkbox value="{{opt.value}}" checked="{{opt.checked}}" bindtap="onSupportTypeTap" data-value="{{opt.value}}" />
            <text>{{opt.label}}</text>
          </view>
        </view>
        <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.support_offerings === 'private' ? 1 : (step5.field_visibility.support_offerings === 'masked' ? 2 : 0)}}" data-step="5" data-field="support_offerings" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.support_offerings === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.support_offerings === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>

        <!-- å†…éƒ¨è¯„ä»·ï¼šèƒ½ä¸ºæ ¡å‹ä¼šåšä»€ä¹ˆ -->
        <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
          <text class="label">èƒ½ä¸ºæ ¡å‹ä¼šåšä»€ä¹ˆï¼ˆåŸå§‹ï¼‰</text>
          <view class="internal-field-row internal-field-row-textarea">
            <view class="original-value-inline">
              <text class="original-text-inline">
                {{step5._original && step5._original.contribution_types ? step5._original.contribution_types : (step5.contribution_types || 'ï¼ˆæœªå¡«å†™ï¼‰')}}
              </text>
            </view>
            <view class="internal-field-column">
              <input class="input input-internal" placeholder="å·¥ä½œäººå‘˜è¯„ä»·ä¸­çš„è´¡çŒ®ç±»å‹" value="{{step5.contribution_types}}" data-step="5" data-field="contribution_types" bindinput="onInputChange" />
            </view>
          </view>
        </view>

        <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
          <text class="label">èƒ½ä¸ºæ ¡å‹ä¼šåšä»€ä¹ˆï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</text>
          <input class="input" placeholder="å¦‚ï¼šå‡ºåœºåœ°ã€å‡ºç»è´¹" value="{{step5.contribution_types}}" data-step="5" data-field="contribution_types" bindinput="onInputChange" />
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.contribution_types === 'private' ? 1 : (step5.field_visibility.contribution_types === 'masked' ? 2 : 0)}}" data-step="5" data-field="contribution_types" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.contribution_types === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.contribution_types === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>

        <!-- å†…éƒ¨è¯„ä»·ï¼šå…·ä½“è´¡çŒ®èƒ½åŠ›æè¿° -->
        <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
          <text class="label">å…·ä½“è´¡çŒ®èƒ½åŠ›æè¿°</text>
          <view class="internal-field-row internal-field-row-textarea">
            <view class="original-value-inline">
              <text class="original-text-inline">
                {{step5._original && step5._original.contribution_description ? step5._original.contribution_description : (step5.contribution_description || 'ï¼ˆæœªå¡«å†™ï¼‰')}}
              </text>
            </view>
            <view class="internal-field-column">
              <textarea class="textarea textarea-internal" placeholder="å·¥ä½œäººå‘˜å¯¹è´¡çŒ®èƒ½åŠ›çš„è¯„ä»·/å¤‡æ³¨" value="{{step5.contribution_description}}" data-step="5" data-field="contribution_description" bindinput="onInputChange" />
            </view>
          </view>
        </view>

        <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
          <text class="label">å…·ä½“è´¡çŒ®èƒ½åŠ›æè¿°</text>
          <textarea class="textarea" placeholder="å…·ä½“æè¿°" value="{{step5.contribution_description}}" data-step="5" data-field="contribution_description" bindinput="onInputChange" />
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.contribution_description === 'private' ? 1 : (step5.field_visibility.contribution_description === 'masked' ? 2 : 0)}}" data-step="5" data-field="contribution_description" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.contribution_description === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.contribution_description === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>
        <view class="section-title">å¯¹æ ¡å‹ä¼šçš„éœ€æ±‚ï¼ˆå¯å¤šé€‰ï¼‰</view>
        <view class="form-group checkbox-group">
          <view class="checkbox-item" wx:for="{{pickerIndexes.associationNeedsWithChecked}}" wx:key="value" wx:for-item="opt">
            <checkbox value="{{opt.value}}" checked="{{opt.checked}}" bindtap="onAssociationNeedTap" data-value="{{opt.value}}" />
            <text>{{opt.label}}</text>
          </view>
        </view>

        <!-- éå†…éƒ¨è¯„ä»·ï¼šå¯¹æ ¡å‹ä¼šéœ€æ±‚å¯è§æ€§ -->
        <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.association_needs_detail === 'private' ? 1 : (step5.field_visibility.association_needs_detail === 'masked' ? 2 : 0)}}" data-step="5" data-field="association_needs_detail" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.association_needs_detail === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.association_needs_detail === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>

        <!-- å†…éƒ¨è¯„ä»·ï¼šå…¶å®ƒéœ€æ±‚ -->
        <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
          <text class="label">å…¶å®ƒéœ€æ±‚ï¼ˆåŸå§‹ï¼‰</text>
          <view class="internal-field-row internal-field-row-textarea">
            <view class="original-value-inline">
              <text class="original-text-inline">
                {{step5._original && step5._original.association_needs_detail && step5._original.association_needs_detail.other ? step5._original.association_needs_detail.other : (step5.association_needs_detail && step5.association_needs_detail.other) || 'ï¼ˆæœªå¡«å†™ï¼‰'}}
              </text>
            </view>
            <view class="internal-field-column">
              <textarea class="textarea textarea-internal" placeholder="å·¥ä½œäººå‘˜å¯¹å…¶å®ƒéœ€æ±‚çš„è¯„ä»·/å¤‡æ³¨" value="{{step5.association_needs_detail && step5.association_needs_detail.other || ''}}" data-step="5" data-field="association_needs_detail.other" bindinput="onInputChange" />
            </view>
          </view>
        </view>
        <view class="form-group form-group-with-visibility">
          <text class="label">å…¶å®ƒéœ€æ±‚ï¼ˆè¯·å¡«å†™ï¼‰</text>
          <textarea class="textarea" placeholder="å…¶å®ƒè¯´æ˜" value="{{step5.association_needs_detail && step5.association_needs_detail.other || ''}}" data-step="5" data-field="association_needs_detail.other" bindinput="onInputChange" />
          <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step5.field_visibility.association_needs_detail_other === 'private' ? 1 : (step5.field_visibility.association_needs_detail_other === 'masked' ? 2 : 0)}}" data-step="5" data-field="association_needs_detail.other" bindchange="onFieldVisibilityChange">
            <view class="visibility-picker">{{step5.field_visibility.association_needs_detail_other === 'private' ? 'ä¸å…¬å¼€' : (step5.field_visibility.association_needs_detail_other === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
          </picker>
        </view>
      </block>
      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>

    <!-- æ­¥éª¤6ï¼šè¡¥å……ï¼ˆéšè—åŒ¹é…ä¿¡æ¯ï¼‰ -->
    <view class="step-content" wx:if="{{currentStep === 6}}">
      <view class="step-title">
        <text>è¡¥å……</text>
        <text class="privacy-note">ğŸ”’ ä»…ç”¨äºåŒ¹é…ï¼Œä¸å¯¹å¤–å±•ç¤º</text>
      </view>

      <!-- éå†…éƒ¨è¯„ä»·ï¼šç›´æ¥å¡«å†™éšè—ä¿¡æ¯ -->
      <view class="form-group form-group-with-visibility" wx:if="{{!isInternalMode}}">
        <text class="label">è¡¥å……è¯´æ˜</text>
        <textarea class="textarea" placeholder="å¯ä»¥å¡«å†™ä¸€äº›ä¸å¸Œæœ›å…¬å¼€ä½†å¸Œæœ›ç”¨äºåŒ¹é…çš„ä¿¡æ¯ï¼Œå¦‚æ€§æ ¼ç‰¹ç‚¹ã€å…´è¶£çˆ±å¥½ã€ç‰¹æ®Šç»å†ç­‰..." value="{{step6.hidden_info.description || ''}}" data-step="6" data-field="hidden_info.description" bindinput="onInputChange" maxlength="1000" />
        <picker mode="selector" range="{{fieldVisibilityOptions}}" range-key="label" value="{{step6.field_visibility.hidden_info_description === 'private' ? 1 : (step6.field_visibility.hidden_info_description === 'masked' ? 2 : 0)}}" data-step="6" data-field="hidden_info.description" bindchange="onFieldVisibilityChange">
          <view class="visibility-picker">{{step6.field_visibility.hidden_info_description === 'private' ? 'ä¸å…¬å¼€' : (step6.field_visibility.hidden_info_description === 'masked' ? 'éƒ¨åˆ†æ‰“ç ' : 'å…¬å¼€')}}</view>
        </picker>
      </view>

      <!-- å†…éƒ¨è¯„ä»·ï¼šéšè—ä¿¡æ¯ -->
      <view class="form-group form-group-internal" wx:if="{{isInternalMode}}">
        <text class="label">è¡¥å……è¯´æ˜</text>
        <view class="internal-field-row internal-field-row-textarea">
          <view class="original-value-inline">
            <text class="original-text-inline">
              {{step6._original && step6._original.hidden_info && step6._original.hidden_info.description ? step6._original.hidden_info.description : (step6.hidden_info.description || 'ï¼ˆæœªå¡«å†™ï¼‰')}}
            </text>
          </view>
          <view class="internal-field-column">
            <textarea class="textarea textarea-internal" placeholder="å·¥ä½œäººå‘˜å¯¹è¡¥å……ä¿¡æ¯çš„è¯„ä»·/å¤‡æ³¨" value="{{step6.hidden_info.description || ''}}" data-step="6" data-field="hidden_info.description" bindinput="onInputChange" maxlength="1000" />
          </view>
        </view>
      </view>

      <view class="privacy-tip">
        <text>ğŸ’¡ è¿™äº›ä¿¡æ¯å°†åŠ å¯†å­˜å‚¨ï¼Œä»…ç”¨äºAIåŒ¹é…ç®—æ³•ï¼Œä¸ä¼šåœ¨æ‚¨çš„å…¬å¼€åç‰‡ä¸­æ˜¾ç¤º</text>
      </view>
      <view class="voice-btn-wrapper">
        <button class="btn-voice" bindtap="goToVoiceInput">ğŸ¤ è¯­éŸ³è¡¥å……</button>
      </view>
    </view>
  </scroll-view>

  <!-- å¯¼èˆªæŒ‰é’® -->
  <view class="nav-buttons">
    <button 
      class="btn-nav btn-prev" 
      wx:if="{{currentStep > 1}}"
      bindtap="prevStep"
    >
      ä¸Šä¸€æ­¥
    </button>
    <button 
      class="btn-nav btn-next" 
      bindtap="nextStep"
    >
      {{currentStep < totalSteps ? 'ä¸‹ä¸€æ­¥' : 'å®Œæˆ'}}
    </button>
  </view>
</view>
