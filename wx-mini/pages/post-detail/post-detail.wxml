<!--pages/post-detail/post-detail.wxml - å¸–å­è¯¦æƒ…é¡µï¼ˆæœ‹å‹åœˆé˜…è¯»è¯„è®ºä½“éªŒï¼‰-->
<view class="detail-page" wx:if="{{post}}">
  <scroll-view scroll-y class="detail-scroll">
    <!-- ä¸»è´´å¡ç‰‡ -->
    <view class="post-card main-post">
      <view class="post-header">
        <image
          class="post-avatar"
          src="{{post.author.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png'}}"
          mode="aspectFill"
        />
        <view class="post-meta">
          <text class="post-author">{{post.author.subtitle}}-{{post.author.name}}</text>
          <text class="post-content">{{post.content}}</text>
          <view class="post-media" wx:if="{{post.images && post.images.length > 0}}">
            <image
              wx:for="{{post.images}}"
              wx:for-item="img"
              wx:key="*this"
              class="post-image"
              src="{{img}}"
              mode="widthFix"
            />
          </view>
          <view class="post-footer">
            <text class="post-location" wx:if="{{post.location}}">{{post.location}}</text>
            <text class="post-time">{{post.timeText}}</text>
          </view>
        </view>
        <text class="post-more">â‹¯</text>
      </view>
    </view>

    <!-- æ´»åŠ¨å‚ä¸åŒº -->
    <view class="participation-section">
      <view class="signup-btn-wrap">
        <view
          class="signup-btn {{signupStatus === 'confirmed' ? 'signup-btn-done' : ''}} {{signupStatus === 'pending' ? 'signup-btn-pending' : ''}}"
          bindtap="onSignupTap"
        >{{signupStatus === 'confirmed' ? 'å·²æŠ¥å' : signupStatus === 'pending' ? 'å¾…å®š' : 'æŠ¥å'}}</view>
      </view>
      <view class="participation-stats">
        <text class="stat-item" bindtap="showParticipantList">{{signups.confirmed.length}}äººå·²æŠ¥å</text>
        <text class="stat-dot">Â·</text>
        <text class="stat-item" bindtap="showParticipantList">{{signups.pending.length}}äººå¾…å®š</text>
        <text class="stat-dot">Â·</text>
        <text class="stat-item">{{post.likeCount}}äººç‚¹èµ</text>
      </view>
      <view class="avatar-row" wx:if="{{signups.confirmed.length > 0 || signups.pending.length > 0}}" bindtap="showParticipantList">
        <image
          wx:for="{{signups.confirmed}}"
          wx:key="id"
          wx:if="{{index < avatarDisplayCount}}"
          class="participation-avatar"
          src="{{item.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png'}}"
          mode="aspectFill"
        />
        <view wx:if="{{signups.confirmed.length > avatarDisplayCount}}" class="avatar-more">+{{signups.confirmed.length - avatarDisplayCount}}</view>
        <view class="avatar-view-all">æŸ¥çœ‹å…¨éƒ¨ â€º</view>
      </view>
    </view>

    <!-- è¯„è®ºåŒºåŸŸ -->
    <view class="comments-section">
      <view class="comments-header">
        <text class="comments-title">Ã— å…¨éƒ¨ {{commentTotal}} æ¡è¯„è®º</text>
        <text class="comments-sort">â‰¡</text>
      </view>
      <view class="comments-label">è¯„è®º({{commentTotal}})</view>
      <view class="comment-list">
        <block wx:for="{{comments}}" wx:key="id">
          <view class="comment-item">
            <image class="comment-avatar" src="{{item.author.avatar}}" mode="aspectFill" />
            <view class="comment-body">
              <text class="comment-author">{{item.author.name}}</text>
              <text class="comment-content">{{item.content}}</text>
              <view class="comment-footer">
                <text class="comment-time">{{item.timeText}}</text>
                <view class="comment-actions">
                  <text class="comment-like">{{item.likeCount}}</text>
                  <text class="comment-like-icon">ğŸ‘</text>
                  <text class="comment-reply-icon">ğŸ’¬</text>
                </view>
              </view>
            </view>
          </view>
          <block wx:for="{{item.replies}}" wx:for-item="reply" wx:key="id">
            <view class="comment-item comment-reply">
              <image class="comment-avatar" src="{{reply.author.avatar}}" mode="aspectFill" />
              <view class="comment-body">
                <text class="comment-author">{{reply.author.name}} â–¶ {{reply.replyTo}}</text>
                <text class="comment-content">{{reply.content}}</text>
                <view class="comment-footer">
                  <text class="comment-time">{{reply.timeText}}</text>
                  <view class="comment-actions">
                    <text class="comment-like">{{reply.likeCount}}</text>
                    <text class="comment-like-icon">ğŸ‘</text>
                    <text class="comment-reply-icon">ğŸ’¬</text>
                  </view>
                </view>
                <!-- äºŒçº§å›å¤ -->
                <block wx:for="{{reply.replies || []}}" wx:for-item="r2" wx:key="id">
                  <view class="comment-item comment-reply-2">
                    <image class="comment-avatar" src="{{r2.author.avatar}}" mode="aspectFill" />
                    <view class="comment-body">
                      <text class="comment-author">{{r2.author.name}} {{r2.replyTo}}</text>
                      <text class="comment-content">{{r2.content}}</text>
                      <view class="comment-footer">
                        <text class="comment-time">{{r2.timeText}}</text>
                        <view class="comment-actions">
                          <text class="comment-like">{{r2.likeCount}}</text>
                          <text class="comment-like-icon">ğŸ‘</text>
                          <text class="comment-reply-icon">ğŸ’¬</text>
                        </view>
                      </view>
                    </view>
                  </view>
                </block>
              </view>
            </view>
          </block>
        </block>
      </view>
    </view>
  </scroll-view>

  <!-- å›ºå®šåº•éƒ¨æ“ä½œæ  -->
  <view class="fixed-bottom-bar">
    <view class="bar-left-group">
      <view class="bar-left">
        <image
          class="bar-avatar"
          src="{{post.author.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png'}}"
          mode="aspectFill"
        />
        <view class="bar-info">
          <text class="bar-name">{{post.author.name}}</text>
          <text class="bar-follow">{{post.author.followerCount || 10}}ä¸ªæœ‹å‹å…³æ³¨</text>
        </view>
      </view>      <view class="bar-follow-btn" bindtap="onFollowTap">+å…³æ³¨</view>
    </view>
    <view class="bar-icons">
      <view class="bar-icon-item" bindtap="onLikeTap">
        <text class="bar-icon">ğŸ‘</text>
        <text class="bar-num">{{post.likeCount}}</text>
      </view>
      <view class="bar-icon-item" bindtap="onShareTap">
        <text class="bar-icon">â†—</text>
        <text class="bar-num">{{post.shareCount || 0}}</text>
      </view>
      <view class="bar-icon-item" bindtap="onHeartTap">
        <text class="bar-icon">â™¥</text>
        <text class="bar-num">42</text>
      </view>
      <view class="bar-icon-item" bindtap="onCommentTap">
        <text class="bar-icon">ğŸ’¬</text>
        <text class="bar-num">{{post.commentCount}}</text>
      </view>
    </view>
  </view>

  <!-- å‚ä¸äººåˆ—è¡¨åŠå±å¼¹çª—ï¼ˆ70vhï¼Œä¾¿äºæµè§ˆè¾ƒå¤šæŠ¥åäººï¼‰ -->
  <view class="participant-modal-mask" wx:if="{{showParticipantModal}}" bindtap="closeParticipantModal">
    <view class="participant-modal-content" catchtap="stopPropagation">
      <text class="participant-modal-close" catchtap="closeParticipantModal">Ã—</text>
      <view class="participant-modal-header">
        <view
          class="participant-tab {{participantTab === 'confirmed' ? 'participant-tab-active' : ''}}"
          data-tab="confirmed"
          bindtap="onParticipantTabTap"
        >å·²æŠ¥å({{signups.confirmed.length}})</view>
        <view
          class="participant-tab {{participantTab === 'pending' ? 'participant-tab-active' : ''}}"
          data-tab="pending"
          bindtap="onParticipantTabTap"
        >å¾…å®š({{signups.pending.length}})</view>
      </view>
      <scroll-view scroll-y class="participant-scroll">
        <view
          wx:for="{{participantTab === 'confirmed' ? signups.confirmed : signups.pending}}"
          wx:key="id"
          class="participant-row"
        >
          <image class="participant-avatar" src="{{item.avatar || 'https://tanmai-1318644773.cos.ap-guangzhou.myqcloud.com/avatars/male-young-1.png'}}" mode="aspectFill" />
          <text class="participant-name">{{item.name}}</text>
          <text class="participant-status">{{participantTab === 'confirmed' ? 'å·²æŠ¥å' : 'å¾…å®š'}}</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
